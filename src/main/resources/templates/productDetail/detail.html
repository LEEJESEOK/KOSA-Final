<!DOCTYPE html>
<html lang="ko" layout:decorate="~{/layout/default}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" type="text/css" href="/css/reviewStyle.css">
</head>
<th:block layout:fragment="bodyWrap">
    <div id="bodyWrap" class="item_detail">
        <div class="adaptive_wrap">
            <div class="clearfix prd_detail1905" id="clearfix">
                <div class="clearfix image_view3">

                    <a href="javascript:imageZoom()" id="btn_zoom" class="btn_zoom">크게보기</a>

                    <div class="image_view1" id="image_view1">
                        <div class="item_visual" id="imageDiv" style="margin-top: 20px;">
                            <ul th:each="colorImage : ${colorImageList}"
                                th:id="|${colorImage.id}_${colorImage.colorId}_image|">
                                <li><img th:src="${colorImage.image1Uri}" class="respon_image"></li>
                                <li><img th:src="${colorImage.image2Uri}" class="respon_image"></li>
                                <li><img th:src="${colorImage.image3Uri}" class="respon_image"></li>
                            </ul>
                        </div>
                    </div>

                    <script type="text/javascript">
                        var amount = 5;
                        var imageList = {};
                        var productInfo = document.location.href.split("/");
                        var salesProduct = productInfo[5].toString().split("?");
                        var productId = salesProduct[0];
                        // var statusValue = '0';
                        // if(salesProduct.length() > 1){
                        //     statusValue = '1';
                        //     pPrice
                        // }

                        console.log(productInfo);
                        console.log(productId);

                        $(document).ready(function () {
                            //대표 가격 형식 바꾸기
                            var spanValue = $("#productPriceSpan");
                            var changeValue = spanValue.text();
                            changeValue = "₩" + priceToString(changeValue);
                            spanValue.text(changeValue);

                            //계산 가격 형식 바꾸기
                            var sumPriceValue = $("#sumPrice");
                            var changeSumValue = sumPriceValue.text();
                            changeSumValue = "₩" + priceToString(changeSumValue);
                            sumPriceValue.text(changeSumValue);

                            //처음 이미지 모두 hide 하고 하나만 기본으로 띄우기
                            var imageDivTag = $('#imageDiv').children('ul');
                            imageDivTag.hide();
                            var firstImageTag = $('#imageDiv').children('ul:eq(0)');
                            firstImageTag.show();

                            //전체 상품평 호출
                            let param = { "pageNum": 1, "amount": amount };
                            getProductReview(param);

                            //상품평 평균 별점 뿌리기
                            var starscore = 0;
                            starscore = $("#avgStar").val();
                            var starWidth = getStarScore(starscore);
                            if (starWidth == 0) {
                                $("#prodTotalStarScoreWrapper").css("display", "none");
                            } else {
                                $("#prodTotalStarScore").css("width", starWidth + "%");
                                $("#totalStarScore").css("width", starWidth + "%");
                            }

                            //상품평 클릭시
                            $(document).on("click", '#all', function () {
                                let param = { "pageNum": 1, "amount": amount };
                                getProductReview(param);
                            });

                            $(document).on("click", '#photo', function () {
                                let param = { "pageNum": 1, "amount": amount };
                                getProductReviewOnlyImg(param);
                            });

                            $(document).on("click", '#text', function () {
                                let param = { "pageNum": 1, "amount": amount };
                                getProductReviewOnlyText(param);
                            });
                        });

                        //상품평 입력시 별점 활성화
                        //삼품평 입력시의 별점 선택시 자동 반영
                        function changeStarReviewInput(tag) {
                            var idx = parseInt(tag.getAttribute('data-value'));
                            for (var i = 1; i < 6; i++) {
                                $('.write_star_score1807 .cmt_star .cmt_per').removeClass(' star' + i);
                            }
                            $('.write_star_score1807 .cmt_star .cmt_per').addClass(' star' + idx);
                            $("#rating").val(idx);
                        }

                        //상품 연령 선택시 hidden input에 값 넣기
                        function setReviewAge() {
                            var ageStr = $('input[name=age]:checked').val();
                            console.log("age : " + ageStr);
                            $("#reviewAge").val(ageStr);
                        }

                        //상품 체형 입력시 hidden input에 값 넣기
                        function setReviewBody() {
                            var bodyStr = $('input[name=bodyType]:checked').val();
                            $("#reviewBody").val(bodyStr);
                        }

                        function priceToString(price) {
                            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                        }

                        function imageChangeDisplay(colorTag) {
                            var str = '#' + productId + '_' + colorTag.id + '_image';
                            console.log(str);
                            var imageTag = $(str);

                            //선택된 것만 display , 나머지 ul 태그 none 하기
                            var imageDivTag = $('#imageDiv').children('ul');
                            imageDivTag.hide();

                            if (imageTag.css('display') == 'none') {
                                imageTag.show();
                                var imgUriValue = imageDivTag.children('li:eq(0)').children('img').attr("src");
                                $('#imgUri').val(imgUriValue);
                                $('#colorNameVal').val(colorTag.id);
                            } else {
                                imageTag.hide();
                            }
                        }

                        function setImages(colorChip) {
                            $(document).ready(function () {
                                $.ajax({
                                    type: "GET",
                                    url: "/product/" + productId + "?color=" + colorChip,
                                    contentType: "application/json; charset=utf-8",
                                    success: function (results) {
                                        var imageBody = $("#imageDiv");
                                        imageBody.empty();
                                        var imageListTag = "";
                                        imageListTag += "<ul>"
                                        imageListTag += "<li>" + "<img src=" + results.image1Uri + " calssName = "
                                            + "respon_image" + ">" + "</li>";
                                        imageListTag += "<li>" + "<img src=" + results.image2Uri + " calssName = "
                                            + "respon_image" + ">" + "</li>";
                                        imageListTag += "<li>" + "<img src=" + results.image3Uri + " calssName = "
                                            + "respon_image" + ">" + "</li>";
                                        imageListTag += "</ul>"
                                        imageBody.append(imageListTag);
                                    },
                                    error: function (request, status, error) {
                                    }
                                });
                            });
                        }

                        function getStarScore(starscore) {
                            var average = starscore;
                            var starWidth = 0;
                            if (1 <= average && average < 1.25) {
                                starWidth = 20;
                            } else if (1.25 <= average && average < 1.75) {
                                starWidth = 30;
                            } else if (1.75 <= average && average < 2.25) {
                                starWidth = 40;
                            } else if (2.25 <= average && average < 2.75) {
                                starWidth = 50;
                            } else if (2.75 <= average && average < 3.25) {
                                starWidth = 60;
                            } else if (3.25 <= average && average < 3.75) {
                                starWidth = 70;
                            } else if (3.75 <= average && average < 4.25) {
                                starWidth = 80;
                            } else if (4.25 <= average && average < 4.75) {
                                starWidth = 90;
                            } else if (4.75 <= average && average <= 5) {
                                starWidth = 100;
                            }
                            return starWidth;
                        }
                    </script>


                    <div class="item_detail_info float_right" id="contentDiv"
                         style="margin-top: 20px; top: 0px; left: 638px;">
                        <div class="info">
                            <div class="info_sect">
                                <h4 class="item_name">
                                    <div class="brand-name">
                                        <a href="javascript:fn_goCategori('br06')" onclick="GA_Detail('brand',$(this))"
                                           th:text="${productDetail.brand}"></a>
                                    </div>
                                    <span class="name ko_fir_spel" th:text="${productDetail.name}">
        				</span>
                                </h4>
                                <div class="flag">
                                </div>

                                <p class="price" th:object="${productDetail}">
                                    <span id="productPriceSpan" th:text="${productDetail.price}"></span>
                                    <input type="hidden" id="productPrice" th:value="*{price}">
                                </p>
                                <!-- 상품추가설명 -->
                                <p class="selling_point"></p>
                                <!-- 20200914이후 추가 상품설명 (신) -->
                                <div class="prod-detail-con-box">
                                    <strong class="number-code">상품품번 : <span
                                            th:text="${productDetail.id}"></span></strong>
                                    <div class="round-style">
                                        <p th:text="${productDetail.detail}"></p>
                                    </div>
                                    <div class="fit-info">
                                        <p class="size-text">

                                    </div>
                                </div>
                            </div>

                            <div class="info_sect">
                                <ul class="point_delivery">
                                    <li>
                                        <span class="title">배송비</span>
                                        <span class="txt">30,000원 이상 무료배송 (실결제 기준)</span>
                                        <a href="javascript:fn_popupDelivery();" class="etc_info"
                                           onclick="GA_Event('상품_상세','배송안내','클릭');">배송안내</a>
                                        <div class="popwrap w_type_2" id="popupDelivery" style="display:none;">
                                            <div class="pop_tltwrap2">
                                                <h3>배송비안내</h3>
                                            </div>
                                            <div class="pop_cnt">
                                                <table class="cnt_type1">
                                                    <caption>배송비안내</caption>
                                                    <colgroup>
                                                        <col style="width:155px">
                                                        <col>
                                                    </colgroup>
                                                    <tbody>
                                                    <tr>
                                                        <th scope="row">배송기간</th>
                                                        <td>평균 입금완료일 기준 2-4일 소요됩니다.<br>(토/일/공휴일 제외)</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">배송비</th>
                                                        <td>
                                                            <ul class="bul_sty01_li">
                                                                <li>30,000원 이상 결제 시 <em class="ft_point01">무료배송</em>
                                                                </li>
                                                                <li>30,000원 미만 결제 시 <em class="ft_point01">2,500원</em>
                                                                </li>
                                                            </ul>
                                                            <p class="bul_sty02">도서산간 지역은 3,000원의 별도 배송비가 부과됩니다.</p>
                                                            <p class="bul_sty02">쿠폰/바우처 할인금액 및 한섬마일리지/H.Point 사용을 제외한
                                                                실결제금액
                                                                기준입니다.</p>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <a href="javascript:void(0);" class="btn_close"><img
                                                    src="http://cdn.thehandsome.com/_ui/desktop/common/images/popup/ico_close.png"
                                                    alt="닫기"></a>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <div class="info_sect">
                                <ul class="color_size_qty">
                                    <li>
                                        <span class="title">색상</span>
                                        <div class="txt">
                                            <input type="hidden" id="colorName" value="">
                                            <ul class="color_chip clearfix">
                                                <input type="hidden" class="colorNameVal" id="colorNameVal">
                                                <li th:each="colorChip : ${colorChipList}"
                                                    th:id="|${colorChip.id}_${colorChip.colorId}|">
                                                    <a th:id="${colorChip.colorId}"
                                                       th:onclick="|javascript:imageChangeDisplay(this)|"
                                                       th:style="'background-image:url('+ ${colorChip.colorChipUri} + '); )'">
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                        <span class="cl_name" id="colorNameContent"></span>
                                    </li>
                                    <li>
                                        <span class="title">사이즈<!-- 사이즈 --></span>
                                        <span class="txt">
                <script type="text/javascript">
                $(document).ready(function () {

                    var tab = $('#size_tab ul li');
                    var content = $('.size_tab_container > div');
                    $('.size_tab_container > div + div').css('display', 'none');
                    tab.on('click', function (e) {
                        e.preventDefault();
                        var tg = $(this);
                        var tc = tg.find('> a');
                        tab.find('> a').removeClass('active');
                        tc.addClass('active');
                        i = tg.index();
                        content.css('display', 'none');
                        content.eq(i).css('display', 'block');
                    });
                });
                </script>
            <ul class="size_chip clearfix sizeChipKo1901">
                <input type="hidden" class="sizeVal" id="sizeVal" value="">
                <li th:each="productSize : ${sizeList}"
                    th:id="|${productSize.id}_${productSize.size}|">
                  <a th:id="${productSize.size}" th:onclick="|javascript:selectSize(this)|"
                     th:text="${productSize.size}">
                  </a>
                </li>
            </ul>
            <script>
              function selectSize(sizeId) {
                  $('#sizeVal').val(sizeId.id);
              }
            </script>
					</span>

                                    </li>
                                    <li>
                                        <span class="title">수량</span>
                                        <span class="txt">
                <span class="qty_sel num">
										<a th:onclick="|javascript:fn_qtySubtraction('${productDetail.price}')|"
                                           class="left">이전 버튼</a>
										<input type="text" id="txtqty" title="수량" value="1" class="mr0"
                                               readonly="readonly">
										<a th:onclick="|javascript:fn_qtyAdd('${productDetail.price}')|" class="right">다음 버튼</a>
								    </span>
                <script>
								    function fn_qtyAdd(product_price) {
                                        var qty = $("#txtqty").val();
                                        qty = parseInt(qty);
                                        qty += 1;
                                        console.log(qty);
                                        let total = product_price * qty;
                                        total = total.toLocaleString();
                                        $("#sumPrice").html("₩" + total);
                                        $("#txtqty").val(qty);
                                    }

                                    function fn_qtySubtraction(product_price) {
                                        var qty = $("#txtqty").val();
                                        qty = parseInt(qty);

                                        if (qty < 2) {
                                            return;
                                        }
                                        qty -= 1;
                                        console.log(qty);
                                        let total = product_price * qty;
                                        total = total.toLocaleString();
                                        $("#sumPrice").html("₩" + total);
                                        $("#txtqty").val(qty);
                                    }
								    </script>
                  </span>
                                    </li>
                                </ul>
                            </div>
                            <div class="total_price clearfix">
                                <div class="title float_left" style="width:auto;">총 합계</div>
                                <div class="pirce float_right">
                                    <span id="sumPrice" th:text="${productDetail.price}"></span>
                                </div>
                            </div>
                            <!-- st_receipt_wrap -->
                            <!-- //st_receipt_wrap -->
                            <!-- st_store_wrap -->
                            <div class="st_store_wrap1807" id="storePickupChoice" style="display:none;">
                                <div class="st_store">
                                    <dl>
                                        <dt>선택 매장</dt>
                                        <dd>
                                            <p id="storePickupChoiceName"></p>
                                            <p id="storePickupChoiceAddress"></p>
                                            <p id="storePickupChoiceTelephone"></p>
                                        </dd>
                                        <dt>수령 신청일</dt>
                                        <dd>
                                            <p id="storePickupChoiceDate"></p>
                                        </dd>
                                    </dl>
                                    <a href="javascript:fn_popupStorePickUp();" class="btn">매장변경</a>
                                </div>
                                <ul class="bul_sty01_li">
                                    <li>매장 수령 시 상품 사이즈 및 컬러 변경은 불가합니다.</li>
                                    <li>수령 가능 확정 일은 주문 완료 후, 수령 교환권을 SMS로 안내 드립니다.</li>
                                    <li>수령 확정일로부터 <span style="color:#fe4242;">1일 경과 후 상품을 수령하지 않으시면 자동 취소</span> 됩니다.
                                    </li>
                                </ul>
                            </div>
                            <!-- //st_store_wrap -->
                            <div class="btnwrap clearfix"
                                 style="position: absolute; width: 473px; margin-top: 0; margin-bottom: 0;">
                                <input type="button" value="" class="btn wishlist1803 float_left ml0  "
                                       onclick="addWishListClick();GA_Event('상품_상세','하단 고정 버튼','좋아요');">

                                <!--190508 추가 -->
                                <div class="toast_popup_pre_order1905"><!-- 토스트팝업 190507 -->
                                    <p>예약 주문이 가능한 옵션(컬러/사이즈)가 있습니다. <br>옵션 선택 후 배송 예정일을 확인해 주세요.</p>
                                    <span class="arr">위치아이콘</span>
                                </div>
                                <!--//190508 추가 -->

                                <form id="addToCartForm" name="addToCartForm"
                                      th:action="@{/order/orderForm}"
                                      method="post">
                                    <input type="hidden" name="brand1" id="brandName" th:value="${productDetail.brand}">
                                    <input type="hidden" name="name1" id="productName" th:value="${productDetail.name}">
                                    <input type="hidden" name="pid1" id="productCode" th:value="${productDetail.id}">
                                    <input type="hidden" name="price1" id="pPrice" th:value="${productDetail.price}">
                                    <input type="hidden" name="image1" id="imgUri">
                                    <input type="hidden" name="pcolor1" id="pcolor1">
                                    <input type="hidden" name="psize1" id="psize1">
                                    <input type="hidden" name="amount1" id="amount1">
                                    <input type="hidden" name="pcount" value="1">
                                    <input type="button" value="쇼핑백 담기" class="btn cart1803 float_left ml0"
                                           id="addToCartButton"
                                           onclick="addToCart();">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <input type="button" onclick="addToOrder()" value="바로주문"
                                           class="btn order float_right mr0" id="addToCartBuyNowButton">
                                </form>
                            </div>

                            <dl class="toggle_type1" style="margin-top:80px;">
                                <dt>
                                    <a href="javascript:void(0);" id="DETAIL_INFO_EVT">
                                        상품정보제공고시</a>
                                </dt>
                                <dd style="display:none;">
                                    <strong>상품품번 :</strong> TH2B9WJM335N<br>
                                    <strong>품목 :</strong> 의류<br>
                                    <strong>소재 :</strong> 겉감 NL : 나일론 100%, 배색 PL : 폴리에스터 96%, PU : 폴리우레탄 4%, 배색1 CT : 면
                                    100%, 배색2 PL : 폴리에스터 96%, PU : 폴리우레탄 4%, 안감1 PL : 폴리에스터 100%, 안감2 CT : 면 100%, PL :
                                    폴리에스터 65%, 안감3 CT : 면 35%, PL : 폴리에스터 65%, 충전재 PL : 폴리에스터 100%(BK,GK)<br>
                                    <strong>색상 :</strong> BK(BLACK), GK(GREY KHAKI)<br>
                                    <strong>사이즈 :</strong> 100, 105, 95, 110<br>
                                    <strong>제조국 :</strong> 한국<br>
                                    <strong>제조사 :</strong> (주)한섬<br>
                                    <strong>제조연월 :</strong> 202110<br>
                                    <strong>세탁방법 및 취급 시 주의사항</strong>
                                    <div class="howToWash renew1907" id="newHowToWash">
                                        <ul>
                                            <li>
                                                <img src="http://cdn.thehandsome.com/pc/laundryMark/pc_ko1/008.png"
                                                     onmouseover="this.src='http://cdn.thehandsome.com/pc/laundryMark/pc_ko2/008_.png'"
                                                     onmouseout="this.src='http://cdn.thehandsome.com/pc/laundryMark/pc_ko1/008.png'"
                                                     onerror="javascript:onErrorImg(this);" alt="008">
                                                <span class="code_num">008</span>

                                            </li>
                                            <li>
                                                <img src="http://cdn.thehandsome.com/pc/laundryMark/pc_ko1/003.png"
                                                     onmouseover="this.src='http://cdn.thehandsome.com/pc/laundryMark/pc_ko2/003_.png'"
                                                     onmouseout="this.src='http://cdn.thehandsome.com/pc/laundryMark/pc_ko1/003.png'"
                                                     onerror="javascript:onErrorImg(this);" alt="003">
                                                <span class="code_num">003</span>

                                            </li>
                                            <li>
                                                <img src="http://cdn.thehandsome.com/pc/laundryMark/pc_ko1/029.png"
                                                     onmouseover="this.src='http://cdn.thehandsome.com/pc/laundryMark/pc_ko2/029_.png'"
                                                     onmouseout="this.src='http://cdn.thehandsome.com/pc/laundryMark/pc_ko1/029.png'"
                                                     onerror="javascript:onErrorImg(this);" alt="029">
                                                <span class="code_num">029</span>

                                            </li>
                                            <li>
                                                <img src="http://cdn.thehandsome.com/pc/laundryMark/pc_ko1/049.png"
                                                     onmouseover="this.src='http://cdn.thehandsome.com/pc/laundryMark/pc_ko2/049_.png'"
                                                     onmouseout="this.src='http://cdn.thehandsome.com/pc/laundryMark/pc_ko1/049.png'"
                                                     onerror="javascript:onErrorImg(this);" alt="049">
                                                <span class="code_num">049</span>

                                            </li>
                                            <li>
                                                <img src="http://cdn.thehandsome.com/pc/laundryMark/pc_ko1/019.png"
                                                     onmouseover="this.src='http://cdn.thehandsome.com/pc/laundryMark/pc_ko2/019_.png'"
                                                     onmouseout="this.src='http://cdn.thehandsome.com/pc/laundryMark/pc_ko1/019.png'"
                                                     onerror="javascript:onErrorImg(this);" alt="019">
                                                <span class="code_num">019</span>

                                            </li>
                                        </ul>
                                        본 제품은 반드시 드라이크리닝 하십시오. 세탁 시 이염, 변색, 탈색될 수 있으니 유의하시기 바랍니다. 단추나 악세서리는 세탁 시 손상될 수
                                        있으므로 은박지로 싸거나 분리하여 주십시오. 특성상 마찰에 의해 올 뜯김 등 원단 손상이 발생할 수 있으니 취급 시 주의하시기
                                        바랍니다.<br><br>
                                    </div>
                                    <br>
                                    <strong>품질보증기준</strong><br>
                                    1. 본 제품은 정부 고시 소비자 분쟁해결 기준에 의거 고객의 정당한 피해를 보상해드립니다. <br> - 원단 불량, 부자재 불량, 봉제 불량, 사이즈
                                    부정확, 부당 표시(미표시 및 부실표시) 및 소재 구성 부적합으로 인한 세탁 사고 : 구입일로부터 1년 이내분은 무상수리, 교환, 구입가 환불함.
                                    (단, 봉제 불량은 1년 경과 후에도 무상 수선 가능) <br> - 사이즈가 맞지 않거나 디자인, 색상 불만 제품 : 구입 후 7일 이내로서 제품에
                                    손상이 없는 경우 동일 가격, 동일 제품으로 교환 가능. <br> - 상하의 한 벌(세트/일착)인 경우 한 쪽에만 이상이 있어도 한 벌(세트/일착)로
                                    처리함. 단, 소재 및 디자인이 다른 경우에는 해당 의류만 교환 가능. <br>2. 소비자 부주의에 의한 제품 훼손, 세탁 잘못으로 인한 변형 및 품질
                                    보증기간(1년)이 경과한 제품에 대해서는 보상의 책임을 지지 않으며, 수선 가능시에는 실비로 수선해드립니다. <br>3. 제품에 이상이 있는 경우 바로
                                    본사로 연락주시면 수선/교환/환불이 가능하나, 타업체(일반 수선실 등)에서 수선했을 경우는 불가능합니다.<br><br>
                                    <div style="margin-bottom:20px;">
                                        <p style="float:left;">
                                            <strong>AS 책임자와 연락처</strong><br>
                                            ㈜한섬/1800-5700</p>
                                        <!-- 20200218 마크 추가 -->
                                        <div class="sft_ksdt">
                                        </div>
                                        <!-- // 20200218 마크 추가 -->
                                    </div>
                                    <br><br>
                                    위 내용은 상품정보제공 고시에 따라 작성되었습니다.
                                </dd>
                                <!-- 2021.08.10 화장품 상품인 경우 실측사이즈 영역 미노출 -->
                                <dt><a href="javascript:void(0);" id="REAL_SIZE_EVT">실측사이즈</a></dt>
                                <dd>
                                    <div class="ko realsize_img SZ08"></div>
                                    <p class="tit">점퍼</p>
                                    <dl class="info_tbl">
                                        <dt>총길이 :</dt>
                                        <dd>67cm</dd>
                                        <dd>
                                        </dd>
                                        <dt class="inline">가슴단면 :</dt>
                                        <dd>70cm</dd>
                                        <dd>
                                        </dd>
                                        <dt class="inline">어깨너비 :</dt>
                                        <dd>62cm</dd>
                                        <dd>
                                        </dd>
                                        <dt>소매길이 :</dt>
                                        <dd>60cm</dd>
                                        <dd>
                                        </dd>
                                        <dt class="inline">소매부리 :</dt>
                                        <dd>11cm</dd>
                                        <dd>
                                        </dd>
                                    </dl>
                                    <!-- info_tbl -->

                                    <!-- //info_tbl -->
                                    <!-- numlist -->
                                    <p class="info2">피팅 정보 : 188cm, 105 사이즈 모델이 105 사이즈 착용</p>
                                    <br>
                                    <!-- //numlist -->
                                    <font color="red">
                                        <strong>
                                            원단, 측정방법에 따라 약간의 오차 가능성이 있습니다.</strong>
                                    </font>

                                    <div class="timehomme_pants_fit" style="display:none"></div>
                                </dd>
                                <dt><a href="#" id="DELI_RETURN_EVT">배송 및 교환/반품</a></dt>
                                <dd>
                                    <p class="tit">배송안내</p>
                                    <dl class="info_tbl">
                                        <dt>배송방식 :</dt>
                                        <dd>우체국택배, CJ대한통운, 부릉, 굿투럭</dd><!-- 210728 oera 신규 추가  -->
                                        <dt>배송지역 :</dt>
                                        <dd>전국 (일부 지역 제외)</dd>
                                        <dt>배송정보 :</dt>
                                        <dd>평균 입금완료일 기준 2-4일 소요됩니다 (토/일/공휴일 제외)</dd>
                                        <dt>배송비 :</dt>
                                        <dd>실결제금액 기준 30,000원 이상 결제 시 무료배송<br>30,000원 미만 결제 시 2,500원(기본 배송비)<br>*
                                            실결제금액이란,
                                            쿠폰/바우처 할인액 및 <br>&nbsp; 한섬마일리지/H.Point 사용 금액을 제외한 금액입니다. <br> &nbsp;&nbsp;(e-money
                                            사용은 실결제금액에 포함)<br>* 도서산간 지역은 3,000원의 별도 배송비가 부과됩니다.<br>* 일부 도서지역은 도선료가 부가될 수
                                            있습니다.
                                        </dd>
                                    </dl>
                                    <p class="tit mt20">교환 및 반품안내</p> <!-- info_tbl -->
                                    <dl class="info_tbl">
                                        <dt>교환/반품 기간 :</dt>
                                        <dd>상품 수령 후, 7일 이내</dd>
                                        <dt>교환절차 :</dt>
                                        <dd style="letter-spacing: -0.2px;"> 사이즈 및 상품불량 교환만 가능(색상교환 불가)하며 교환을 원하실 경우<br>
                                            고객센터로 문의해주시기 바랍니다. (교환 재고가 없을 경우, 환불로 안내예정)<br> - 교환은 배송비 입금 및 상품 입고 확인 이후에
                                            진행됩니다. <br> 화장품은 상품 불량만 교환 가능하며(상품 개봉 후 교환 불가), 고객센터로<br> 문의해주시기 바랍니다.
                                            <!-- 210728 oera 신규 추가  --> </dd>
                                        <dt>반품절차 :</dt>
                                        <dd>[배송완료] 7일 이내에 마이페이지 주문/배송/취소/반품 메뉴에서<br> [반품신청] 버튼을 클릭 시 가능합니다.</dd>
                                        <dt>교환/반품 배송비 :</dt>
                                        <dd style="letter-spacing: -0.4px;">배송비는 5,000원 이며(반품비는 주문시 배송비 결제 유무에 따라
                                            변동)<br>상품
                                            불량 등의 이유로 교환/반품하실 경우, 배송비는 무료입니다.
                                        </dd>
                                        <dt>교환/반품 불가사유</dt>
                                        <dd>다음의 경우에는 교환/반품이 불가합니다.
                                            <ol class="numlist">
                                                <li><span class="num sum">-</span> <span class="txt">교환/반품 기간(상품 수령 후 7일 이내)을 초과하였을 경우</span>
                                                </li>
                                                <li><span class="num sum">-</span> <span class="txt">고객님의 요청에 의해 제품 사양이 변경(이니셜 제품, 사이즈 맞춤 제품 등)된 경우</span>
                                                </li>
                                                <li><span class="num sum">-</span><span class="txt">제품을 이미 사용하였거나, 제품 일부를 소비하였을 경우</span>
                                                </li> <!-- 210728 oera 신규 추가  -->
                                                <li><span class="num sum">-</span> <span class="txt">화장품 : 상품 개봉 후 교환/반품 불가. 단 상품 불량(내용물 불량) 혹은 피부 트러블로 인한 반품은 가능(용량 1/3 미만 사용 및 의사소견서 1:1문의 첨부 필수)</span>
                                                </li> <!-- // 210728 oera 신규 추가  -->
                                                <li><span class="num sum">-</span> <span class="txt">식기류 : 제품 수령 후, 비닐포장을 개봉한 경우</span>
                                                </li>
                                                <li><span class="num sum">-</span> <span
                                                        class="txt">고객님의 귀책사유로 인해 회수가 지연될 경우</span></li>
                                                <li><span class="num sum">-</span> <span class="txt">국내외 환율 변동 등에 의해 가격이 변동되는 제품의 경우</span>
                                                </li>
                                                <li><span class="num sum">-</span> <span class="txt">문제소지가 있는 제품을 본사가 아닌, 타 업체(일반 수선실 등)에서 선처리가 된 경우</span>
                                                </li>
                                            </ol>
                                        </dd> <!-- 210728 oera 신규 추가  -->
                                        <dt>교환/반품건 배송</dt>
                                        <dd>교환/반품 시 배송 받으신 박스로 반송하셔야 합니다. <br>(한섬/오에라/리퀴드퍼퓸바 상품 함께 주문 후 교환/반품 시 각각의 박스에
                                            나눠서 반송해주세요. 한 박스에 함께 동봉하여 반송 시 교환/반품 처리가 불가할 수 있습니다)
                                        </dd> <!-- // 210728 oera 신규 추가  --> </dl>
                                    <p class="tit mt20">환불안내</p>
                                    <p>환불은 반송제품 확인 후 진행됩니다.</p><br>
                                </dd>

                                <!-- 상품평 팝업 기능 -->
                                <div class="popup_customer_review1807" id="customerReview" style="display: block">
                                    <!--                <a id="btn-modal" th:onclick="|javascript:openProductReview()|">상품평(<span-->
                                    <!--                    id="customerReviewCnt"></span>)-->
                                    <a id="btn_modal">상품평(<span
                                            id="customerReviewCnt" th:text="${reviewCnt}"
                                            th:value="${reviewCnt}"></span>)

                                        <div class="star_score1807" id="prodTotalStarScoreWrapper">
                                            <input type="hidden" id="avgStar" th:value="${avgTotal}">
                                            <span class="cmt_star">
                       <!-- 별점에 따라 class명 변경 (star1, star2 ,star3, star4, star5) -->
                        <span class="cmt_per" id="prodTotalStarScore" style="width: 100%;">별점</span>
                    </span>
                                        </div>
                                    </a>
                                </div>
                                <!--//상품평 btn-->
                            </dl>
                        </div>
                        <input type="hidden" id="viewExhibitionPageCode" value="">
                        <input type="hidden" id="viewExhibitionPageName" value="">
                        <input type="hidden" id="vs-product-id" value="TH2B9WJM335N_BK">
                        <input type="hidden" id="vs-product-version" value="1">
                        <input type="hidden" id="vs-product-image-url"
                               value="http://newmedia.thehandsome.com/TH/2B/FW/TH2B9WJM335N_BK_T01.jpg">
                    </div>

                    <form id="PAY_FORM" method="post" accept-charset="euc-kr">
                    </form>
                </div>
                <div class="product-detail-img">
                </div>
            </div>
        </div>

        <div class="popwrap w_type_4" id="customerReviewDiv"
             style="top: 1023px; position: absolute; z-index: 101; display: none">
            <!--마일리지 안내영역 1906 -->
            <div class="mileage_info_wrap1906">
                <p class="wrap_heading">상품평 작성 시 추가 마일리지를 드려요!</p>
                <div class="mileage_info_box">
                    <div class="review_w">
                        <p class="review_w_tit">• 온라인 구매 상품평 작성 시</p>
                        <ul>
                            <li>
                                <div class="ico_mileage1906">
                                    정상상품
                                </div>
                                <p><strong>정상상품</strong><br>구매금액의 <b>0.5%</b></p>
                            </li>
                            <li>
                                <div class="ico_mileage1906">
                                    아울렛상품
                                </div>
                                <p><strong>아울렛상품</strong><br>구매금액의 <b>0.1%</b></p>
                            </li>
                            <li>
                                <div class="ico_mileage1906">
                                    포토상품평
                                </div>
                                <p><strong>포토상품평</strong><br>(상품별 최초)<br><b>2,000마일리지</b></p>
                            </li>
                        </ul>
                    </div>
                    <div class="best_review">
                        <p class="review_w_tit">• 온/오프라인 구매</p>
                        <ul>
                            <li>
                                <div class="ico_mileage1906">
                                    베스트리뷰
                                </div>
                                <p><strong>베스트리뷰</strong><br>매월 5명 <b>10만원</b> 바우처</p>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="noti_box" style="display:none;">
                    <ul class="bul_sty01_li">
                        <li>마일리지는 배송 완료일로부터 30일 이내, 작성한 상품평에 한하여 제공됩니다.</li>
                        <li>상품평 작성 시, 제공되는 추가 마일리지는 온라인에서 구입한 상품에 한하여 제공됩니다.</li>
                        <li>베스트 리뷰는 온라인/오프라인에서 구매한 상품의 상품평 전체를 대상으로 선정합니다.</li>
                        <li>할인, 쿠폰 적용 후 실결제금액이 5,000원 이상인 상품에 한하여 지급됩니다.</li>
                        <li>판매가 종료된 상품의 경우, 상품 상세페이지가 소멸되어 상품평 작성 및 마일리지 적립이 불가능합니다.</li>
                    </ul>
                </div>
                <div class="btn_noti_box"><span>자세히 보기</span></div>
            </div>
            <!--//마일리지 안내영역 1906 -->
            <div class="pop_tltwrap2 pb0 customerreviewdiv1905">

                <h3>
                    상품평(<span id="review_cnt" class="review_cnt" th:text="${reviewCnt}"></span>)
                </h3>
                <div class="star_score1807" id="totalStarScoreWrapper" style="display: inline-block;">
            <span class="cmt_star">
                 <!-- 별점에 따라 class명 변경 (star1, star2 ,star3, star4, star5) -->
                <span class="cmt_per" id="totalStarScore" style="width: 0%;">별점</span>
            </span>
                </div>
                <span class="w-btn w-btn-gra1 review-btn">  긍정  </span>
                <span th:text="|${positivePercent} %|"></span>
                <span class="w-btn w-btn-gra1-2 review-btn">  보통  </span>
                <span th:text="|${normalPercent} %|"></span>
                <span class="w-btn w-btn-gra2 review-btn">  부정  </span>
                <span th:text="|${negativePercent} %|"></span>
                <a class="btn_evaluation1905" id="customerReviewWrite">상품평 작성하기</a>
            </div>
            <!-- pop_cnt-->
            <div class="pop_cnt evaluation_list1807 options">
                <div class="tab_a m3 mt20">
                    <input type="hidden" id="review_tab_active" value="ALL">

                    <ul id="review_tab">
                        <li id="all"><a class="active" th:text="|전체 (${reviewCnt})|"></a></li>
                        <li id="photo"><a class="" th:text="|포토 상품평 (${imgCnt})|"></a></li>
                        <li id="text"><a class="" th:text="|일반 상품평 (${textCnt})|"></a></li>
                    </ul>

                </div>
                <div class="clearfix review_tab1_1807" id="review_table">
                    <!--  여기에 ajax를 요청하고 값을 불러온뒤 innerHtml로 넣어준다.       -->
                </div>

                <!-- paging -->
                <div class="paging mt30" id="reviewPagingDiv">
                    <a class="prev2" href="javascript:void(0);">처음 페이지로 이동</a>
                    <a href="javascript:void(0);" onclick="paging()" class="prev">이전 페이지로 이동</a>
                    <span class="num" id="pagingSpan">
<!--                        <a href="javascript:void(0);" class="pageBtn  on  " pagenum="1">1</a>-->
                    </span>
                    <a href="javascript:void(0);" class="next">다음 페이지로 이동</a>
                    <a href="javascript:void(0);" class="next2">마지막 페이지로 이동</a>
                </div>
                <!-- //paging -->

            </div>
            <!--// pop_cnt-->
            <a href="javascript:popUpClose(this);" class="btn_close" id="pop_up_close">
                <img src="http://cdn.thehandsome.com/_ui/desktop/common/images/popup/ico_close.png" alt="닫기">
            </a>
        </div>

        <!-- 상품평 입력창 열기  -->
        <div class="popwrap w_type_4" id="customerReviewWriteDiv"
             style="top: 1023px; position: absolute; z-index: 101; display: none;">
            <div class="pop_tltwrap2 customerreviewwritediv1807">
                <h3 id="review_title">상품평 작성하기</h3>
                <p class="reqd_txt float_right"><strong class="reqd">*</strong> 표시는 필수항목입니다.</p>
            </div>
            <div class="pop_cnt evaluation_write1905 options1811">
                <form id="reviewForm" name="reviewForm"
                      action="/ko/HANDSOME/MEN/OUTER/DOWN-JUMPER/%ED%9B%84%EB%93%9C-%ED%8C%A8%EB%94%A9-%ED%94%8C%EB%9D%BC%EC%9D%B4%ED%8A%B8-%EC%A0%90%ED%8D%BC/p/TH2B9WJM335N_BK?categoryCode=ME03"
                      method="post" enctype="multipart/form-data">
                    <input type="hidden" name="productCode">
                    <input type="hidden" name="userEmail" id="userEmail" th:value="${userEmail}">
                    <input type="hidden" name="ctryLarge" id="ctryLarge"
                           th:value="${productDetail.categoryLarge}">
                    <input type="hidden" name="ctryMedium" id="ctryMedium"
                           th:value="${productDetail.categoryMedium}">
                    <input type="hidden" name="ctrySmall" id="ctrySmall"
                           th:value="${productDetail.categorySmall}">

                    <fieldset>
                        <legend>상품평쓰기</legend>
                        <div class="tblwrap">
                            <table class="tbl_wtype1">
                                <caption>상품평쓰기 입력항목</caption>
                                <colgroup>
                                    <col style="width:135px">
                                    <col>
                                    <col style="width:130px">
                                    <col>
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th scope="row" class="th_space">상품명</th>
                                    <td colspan="3" style="padding:15px;">
                                        <div class="item_box" id="reviewProductDiv">
                                            <div class="pt_list_all">
                                                <a href="#;">
                                                    <img
                                                            src="http://cdn.thehandsome.com/_ui/desktop/common/images/products/no_img1.jpg"
                                                            id="reviewProducImg" alt="상품 이미지"
                                                            th:src="${colorImageList[0].image1Uri}">
                                                </a>
                                                <div class="tlt_wrap review_header_wrapper">
                                                    <!-- <div class="tlt_wrap review_header_wrapper nodata"> -->
                                                    <a href="" class="basket_tlt">
                          <span class="tlt" id="reviewProductBrandName"
                                th:text="${productDetail.brand}"></span>
                                                        <span class="sb_tlt" id="reviewProductProductName"
                                                              th:text="${productDetail.name}"></span> /
                                                        <span id="reviewProducPrice"
                                                              th:text="${productDetail.price}"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="tbl_blank1807">
                                    <td colspan="4">&nbsp;</td>
                                </tr>
                                <tr class="radio_btn_1905 bk">
                                    <th scope="row" class="th_space">연 령</th>
                                    <td colspan="3">
                                        <input type="hidden" id="reviewAge" name="reviewAge">
                                        <input onclick="setReviewAge()" id="ageG1" type="radio" name="age"
                                               value="18세 이하">
                                        <label for="ageG1">18세 이하</label>
                                        <input onclick="setReviewAge()" id="ageG2" type="radio" name="age"
                                               value="20대">
                                        <label for="ageG2">20대</label>
                                        <input onclick="setReviewAge()" id="ageG3" type="radio" name="age"
                                               value="30대">
                                        <label for="ageG3">30대</label>
                                        <input onclick="setReviewAge()" id="ageG4" type="radio" name="age"
                                               value="40대">
                                        <label for="ageG4">40대</label>
                                        <input onclick="setReviewAge()" id="ageG5" type="radio" name="age"
                                               value="50대">
                                        <label for="ageG5">50대</label>
                                        <input onclick="setReviewAge()" id="ageG6" type="radio" name="age"
                                               value="60대 이상">
                                        <label for="ageG6">60대 이상</label>
                                    </td>
                                </tr>
                                <tr class="input_txt_1905">
                                    <th scope="row" class="th_space" id="thHeight">
                                        <strong class="reqd">*</strong>
                                        키
                                    </th>
                                    <td><input type="text" name="height" id="height" style="width:75%amrgin-right:10px">cm
                                    </td>
                                    <th scope="row" class="th_space" id="thEnjoySize">
                                        <strong class="reqd">*</strong>
                                        평소 사이즈
                                    </th>
                                    <td><input type="text" name="enjoySize" id="enjoySize"></td>
                                </tr>
                                <tr class="radio_btn_1905">
                                    <th scope="row" class="th_space" id="thBodyType">
                                        <strong class="reqd">*</strong>
                                        체 형
                                    </th>
                                    <td colspan="3">
                                        <input type="hidden" id="reviewBody" name="reviewBody">
                                        <input onclick="setReviewBody()" id="dark1" type="radio" name="bodyType"
                                               value="마른 체형">
                                        <label for="dark1">마른 체형</label>
                                        <input onclick="setReviewBody()" id="dark2" type="radio" name="bodyType"
                                               value="보통">
                                        <label for="dark2">보통</label>
                                        <input onclick="setReviewBody()" id="dark3" type="radio" name="bodyType"
                                               value="통통한 체형">
                                        <label for="dark3">통통한 체형</label>
                                    </td>
                                </tr>
                                <tr class="tbl_blank1807">
                                    <td colspan="4">&nbsp;</td>
                                </tr>
                                <tr class="write_star_wrap">
                                    <th colspan="4">
                                        <div class="write_star_score1807">
                      <span class="cmt_star">
                          <span class="cmt_per">별점</span>
                      </span>
                                            <ul class="btn_star_score">
                                                <li><a href="javascript:;" onclick="changeStarReviewInput(this)"
                                                       data-value="1">1점</a></li>
                                                <li><a href="javascript:;" onclick="changeStarReviewInput(this)"
                                                       data-value="2">2점</a></li>
                                                <li><a href="javascript:;" onclick="changeStarReviewInput(this)"
                                                       data-value="3">3점</a></li>
                                                <li><a href="javascript:;" onclick="changeStarReviewInput(this)"
                                                       data-value="4">4점</a></li>
                                                <li><a href="javascript:;" onclick="changeStarReviewInput(this)"
                                                       data-value="5">5점</a></li>
                                                <input type="hidden" id="rating" name="rating" value="">
                                            </ul>
                                            <p>평점을 선택해 주세요.</p>
                                        </div>
                                    </th>
                                </tr>
                                <tr>
                                    <th scope="row">
                                        <strong class="reqd" style="margin-top:6px;">*</strong>
                                        <label style="margin-top:6px;">상품평<br>
                                            <span class="subtxt_1905">
                                            (20자 이상<br>&nbsp;200자 이하)</span>믿ㄳ
                                        </label>
                                    </th>
                                    <td colspan="3">
                  <textarea id="reviewHeadline" name="headline" cols="30" rows="5"
                            style="width:98%;height:78px" maxlength="200"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row" id="thFile" class="th_space"><label>사진등록</label></th>
                                    <td colspan="3">
                                        <!-- File upload -->
                                        <div class="file_upload hs_input_file_wrap2003">
                                            <div class="upload_wrap2003">
                                                <input type="text" id="textReviewFile" class="text" title="파일 첨부하기"
                                                       readonly="readonly" name="fileText">
                                                <div class="upload_btn">
                                                    <input type="file" name="reviewFile" id="reviewFile"
                                                           class="btn add_s"
                                                           title="파일찾기" onchange="handleFiles(this.files)">
                                                    <label for="reviewFile">
                                                        <!-- 	 <button type="button" id="uploadFile1" class="img_upload" title="파일찾기">  -->
                                                        <span id="uploadFile1" class="img_upload">파일찾기</span>
                                                        <!--	 </button> -->
                                                    </label>

                                                </div>
                                            </div>
                                            <ul class="file_image_wrap2003">

                                            </ul>
                                            <p class="txt_guide">10MB 미만의 jpg,gif,png 파일만 첨부하실 수 있습니다.</p>
                                            <!-- //File upload -->
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <p class="txt_guide">
                                <span style="color:#e46764; font-weight: bold;">- 상품평과 무관한 내용이거나  상품 재판매, 광고, 동일 문자의 반복 및 기타 불법적인 내용은 통보 없이 삭제되며,<br>&nbsp;&nbsp;해당 글 작성자 ID는 글쓰기 권한이 제한됩니다.</span><br>-
                                반품, 취소 등의 CS관련 글은 고객센터&gt;1:1문의로 이동될 수 있습니다.<br>
                                <span>- 더한섬닷컴에서 구매한 상품의 상품평을 배송완료 30일 이내 작성 시, 추가 마일리지를 지급합니다.</span><br>

                                - 마일리지 지급에 대한 상세 내용은 마이페이지&gt;내 상품평 페이지에서 확인 부탁드립니다.<br>
                                &nbsp;&nbsp;(마일리지 적립은 오프라인 구매 및 간편회원 제외)</p>
                        </div>
                        <!--로딩바-->
                        <div id="loading" style="margin-left: 0px; display:none; text-align: center;">
                            <img src="/images/common/loading.gif">
                            <p>분석중입니다.</p>
                        </div>
                        <div class="btnwrap mt40">
                            <input type="button" onclick="popUpCloseInputForm()" id="reviewCancle" value="취소하기"
                                   class="btn wt">
                            <input type="button" onclick="reviewInsertForm()" id="reviewWriteSend" value="등록하기"
                                   class="btn gray mr0">
                        </div>

                    </fieldset>
                </form>
            </div>
            <a href="javascript:popUpCloseInputForm();" id="reviewCloseBtn"
               style="position: absolute; top: 20px; right: 20px; width: 20px; height: 20px;">
                <img src="http://cdn.thehandsome.com/_ui/desktop/common/images/popup/ico_close.png" alt="닫기">
            </a>
        </div>
        <!--   상품명 입력창 닫기 -->

        <div class="layerArea" id="productLayer" style="display: none;">
            <div class="layerBg" tabindex="-1"></div>
        </div>
        <script text="javascript">

            //상품평 모달 창
            const modal = document.getElementById("customerReviewDiv");
            const btnOpenPopup = document.getElementById("customerReview");
            const background = document.getElementById("productLayer");

            btnOpenPopup.addEventListener('click', () => {
                modal.style.display = 'block';
                background.style.display = 'block';
                modal.style.top = '50%';
                modal.style.top = '50%';
            });

            // 상품평 입력 모달 창
            const modal2 = document.getElementById("customerReviewWriteDiv");
            const btnOpenPopupInputForm = document.getElementById("customerReviewWrite"); //상품평 입력폼

            var productSize;
            var productColorId;

            //상품평 입력하기 버튼 클릭시
            btnOpenPopupInputForm.addEventListener('click', () => {

                //user가 로그인 되어 있는지 확인 필요
                var getLoginUserEmail = $("#userEmail").val();

                //로그인이 되어 있지 않으면 보낸다.
                if (getLoginUserEmail == null || getLoginUserEmail === '') {
                    console.log('사용자 이메일 : ' + getLoginUserEmail);
                    location.href = "/member/login";
                    return;
                }

                //사용자 주문 주문 조회 확인
                $.ajax({
                    type: "GET",
                    url: "/order/confirm",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: {
                        productId: productId,
                        email: getLoginUserEmail
                    },
                    success: function (results) {
                        if (results.confirm === 1) {
                            //주문 사이즈 , 주문 컬러
                            productSize = results.psize;
                            productColorId = results.pcolor;
                            console.log("confirm : " + results.confirm);
                            console.log("productSize : " + results.psize);
                            console.log("productColorId : " + results.pcolor);

                            //상품평 작성시 : 상품평에 필요한 가격표 form 변경
                            var reviewInputTag = $("#reviewProducPrice");
                            var changePriceForm = priceToString(reviewInputTag.text());
                            reviewInputTag.text(changePriceForm);

                            // 기존 상품평 가리기
                            modal.style.display = 'none';

                            //성공시 띄우기
                            modal2.style.display = 'block';
                            modal2.style.top = '50%';
                            modal2.style.top = '50%';
                        } else if (results.confirm === 0) {
                            layerAlert("주문 완료 또는 배송이 완료되지 않았습니다.");
                        } else if (results.confirm === 2) {
                            layerAlert("이미 상품평을 작성하셨습니다.")
                        } else {
                            layerAlert("주문 완료후 7일 이내에만 작성이 가능합니다.")
                        }
                    },
                    error: function (request, status, error) {
                    }
                });
            });

            function addToOrder() {
                const pcolor = $('#colorNameVal').val();
                const psize = $('#sizeVal').val();
                const amount = parseInt($('#txtqty').val());
                const p_price = $('#pPrice').val() * amount;

                //hidden tag에 넣어주기
                $('#pcolor1').val(pcolor);
                $('#psize1').val(psize);
                $('#amount1').val(amount);
                $('#pPrice').val(p_price);

                if(typeof pcolor == "undefined" || pcolor == null || pcolor === ""){
                    layerAlert("컬러를 선택해 주어야 합니다.");
                    return;
                }

                if(typeof psize == "undefined" || psize == null || psize === ""){
                    layerAlert("사이즈를 선택해 주어야 합니다.");
                    return;
                }

                if(typeof amount == "undefined" || amount == null || amount === ""){
                    layerAlert("수량을 선택해 주어야 합니다.");
                    return;
                }

                $('#addToCartForm').submit();
            }

            //장바구니 담기 Ajax
            function addToCart() {
                const pid = productId;
                var p_color = $('#colorNameVal').val();
                const p_size = $('#sizeVal').val();
                const amount = $("#txtqty").val();
                var getLoginUserEmail2 = $("#userEmail").val();

                //로그인이 되어 있지 않으면 보낸다.
                if (getLoginUserEmail2 == null || getLoginUserEmail2 === '') {
                    console.log('사용자 이메일 : ' + getLoginUserEmail2);
                    location.href = "/member/login";
                    return;
                }

                if(typeof p_color == "undefined" || p_color == null || p_color === ""){
                    layerAlert("컬러를 선택해 주어야 합니다.");
                    return;
                }

                if(typeof p_size == "undefined" || p_size == null || p_size === ""){
                    layerAlert("사이즈를 선택해 주어야 합니다.");
                    return;
                }

                if(typeof amount == "undefined" || amount == null || amount === ""){
                    layerAlert("수량을 선택해 주어야 합니다.");
                    return;
                }

                const csrf_token = "[[${_csrf.token}]]";
                const csrf_header = "[[${_csrf.headerName}]]";

                const data = {
                    pid: pid,
                    pcolor: p_color,
                    psize: p_size,
                    amount: amount,
                    userEmail: getLoginUserEmail2
                };

                $.ajax({
                    type: "POST",
                    url: "/cart/insert",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(data),
                    dataType: "json",
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader(csrf_header, csrf_token);
                    },
                    success: function (data) {
                        //원래 페이지 다시 로드
                        location.href = "/cart/cartList";
                    },
                    error: function (request, status, error) {
                    }
                });
            }

            //상품 입력 처리 Ajax
            function reviewInsertForm() {
                // 로딩바 띄우기
                $("#loading").show();

                const age = $("#reviewForm [name=reviewAge]").val();
                const height = $("#reviewForm [name=height]").val();
                const avgSize = $("#reviewForm [name=enjoySize]").val();
                const bodyType = $("#reviewForm [name=reviewBody]").val();
                const rate = $("#reviewForm [name=rating]").val();
                const reviewContents = $("#reviewForm [name=headline]").val();
                const imgFile = document.querySelector("#reviewForm [name=reviewFile]").files[0];
                const getUserEmail = $("#userEmail").val();

                // 값을 채워줘야한다.
                var ctryLarge = $("#ctryLarge").val();
                var ctryMedium = $("#ctryMedium").val();
                var ctrySmall = $("#ctrySmall").val();

                //Multipart/form-data
                const formData = new FormData();
                formData.append("email", getUserEmail); //임의로 넣은 값
                formData.append("productId", productId);
                formData.append("age", age);
                formData.append("height", height);
                formData.append("avgSize", avgSize);
                formData.append("bodyType", bodyType);
                formData.append("rate", rate);
                formData.append("content", reviewContents);
                formData.append("title", '상품 리뷰 입력');
                formData.append("productSize", productSize);
                formData.append("productColorId", productColorId);
                formData.append("ctryLarge", ctryLarge);
                formData.append("ctryMedium", ctryMedium);
                formData.append("ctrySmall", ctrySmall);
                if (imgFile) {
                    formData.append("imgFIle", imgFile);
                }

                const csrf_token = "[[${_csrf.token}]]";
                const csrf_header = "[[${_csrf.headerName}]]";

                $.ajax({
                    type: "POST",
                    url: "/product_review/insert",
                    processData: false,
                    contentType: false,
                    cache: false,
                    data: formData,
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader(csrf_header, csrf_token);
                    },
                    success: function (data) {
                        //원래 페이지 다시 로드
                        location.reload();
                    },
                    error: function (request, status, error) {
                    }
                });
            }

            //상품 리뷰 입력시 이미지 파일 처리
            var reviewFileElement = $("#textReviewFile");

            function handleFiles(files) {
                console.log(files);
                // 이미지 파일인지 확인
                confirmFileExtension(files);
            }

            //이미지 파일인지 확인하는 로직
            function confirmFileExtension(files) {
                var reg = /(.*?)\.(jpg|jpeg|png|gif|bmp)$/;

                $.each(files, function (idx, val) {
                    if ((val.name).match(reg)) {
                        reviewFileElement.val(val.name);
                        console.log("파일 이름 : " + val.name);
                    } else {
                        layerAlert("해당 파일은 이미지 파일이 아닙니다.");
                        //파일 초기화
                        $("#reviewFile").val("");
                    }
                });
            }

            function popUpClose(popUp) {
                $("#customerReviewDiv").hide();
                background.style.display = 'none';
                popUp.display = 'none';
            }

            function popUpCloseInputForm() {
                var reviewInputTag = $("#reviewCloseBtn");
                $("#customerReviewWriteDiv").hide();

                //입력 폼 닫을시 기존 상품평 보이게 하기
                modal.style.display = 'block';
                reviewInputTag.display = 'none';
            }

            function changeDateFormat(date) {
                var changeDate = date.split("T");
                console.log(changeDate);
                return changeDate[0];
            }

            function getProductReviewOnlyImg(param) {
                $.ajax({
                    type: "POST",
                    url: "/product_review/" + productId + "/image",
                    data: JSON.stringify(param),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        let results = data.list;
                        let page = data.page;

                        var divBody = $("#review_table");
                        divBody.empty();
                        var reviewListTag = "";

                        reviewListTag += "<ul>"
                        var index = 0;
                        var count = Object.keys(results).length;
                        if (count === 0) {
                            reviewListTag += "<li class='evaluation_view no_list_data1905' style='text-align:center'>";
                            reviewListTag += "등록된 상품평이 없습니다.";
                            reviewListTag += "<br>"
                            reviewListTag += "이 상품에 대한 첫 번재 리뷰 글을 작성해주세요~";
                            reviewListTag += "</li>";
                        } else {
                            for (var review of results) {
                                var changeDate = changeDateFormat(review.editDate);
                                console.log(review);

                                reviewListTag += "<li class=" + "'evaluation_view'" + " id=" + "'evaluation_view"
                                    + index
                                    + "'>";
                                //회원 정보 div
                                reviewListTag += "<div class=" + "'member_info_top'" + ">";
                                reviewListTag += "<ul>";
                                reviewListTag += "<li class='name'>" + review.email + "</li>";
                                reviewListTag += "<li class='grade'>" + review.grade + "</li>";
                                reviewListTag += "<li class='date'>" + changeDate + "</li>";
                                reviewListTag += "<li class='stars'>";
                                // 별점은 추후 수정하기
                                reviewListTag += "   <div class='star_score1807'>"
                                reviewListTag += "      <span class='cmt_star'>";
                                reviewListTag += "        <span class='cmt_per star" + review.rate + "'>" + "별점"
                                    + "</span>";
                                reviewListTag += "      </span>";
                                reviewListTag += "</li>";
                                if(review.sentiment_type === "긍정"){
                                    reviewListTag += "<li><span class='w-btn w-btn-gra1 review-btn'>  긍정 </span></li>"
                                }
                                else if(review.sentiment_type === "보통") reviewListTag += "<li><span class='w-btn w-btn-gra1-2 review-btn'>  보통  </span></li>"
                                else reviewListTag += "<li><span class='w-btn w-btn-gra2 review-btn'>  부정  </span></li>"

                                reviewListTag += "</ul>";
                                reviewListTag += "</div>";

                                reviewListTag += "<div class=" + "'member_info_bottom'" + ">";
                                reviewListTag += "<ul>";
                                reviewListTag += "<li class=" + "'choice'>" + " • ";
                                reviewListTag += "<span>" + review.age + "</span>" + " / " + "<span>"
                                    + review.height + "CM" + "</span>" + " / " + "<span>" + review.bodyType
                                    + "</span>"
                                    + " / " + "<span>평소사이즈 : " + review.avgSize + "</span>";
                                reviewListTag += "</li>";
                                reviewListTag += "<li class=" + "'must'>" + " • 구매 정보 : ";
                                reviewListTag += "<span>" + review.productColorId + "</span>" + " / " + "<span>"
                                    + review.productSize + "</span>" + " / " + "<span>더한섬닷컴</span>";
                                reviewListTag += "</li>";
                                reviewListTag += "</ul>";
                                reviewListTag += "</div>";

                                if (review.imgURI != null || review.imgURI === '') {
                                    reviewListTag += "<div class='review_represent_img1912'>";
                                    reviewListTag += "<img src='" + review.imgURI + "' alt='리뷰 이미지'>";
                                    reviewListTag += "</div>";
                                }

                                reviewListTag += "<div class=" + "'review_txt_wrap'" + ">";
                                reviewListTag += "  <p class=" + "'review_txt'" + " style='word-wrap:break-word'>"
                                    + review.content + "</p>";
                                reviewListTag += "</div>";

                                reviewListTag += "<div class='review_more_1807'>";
                                reviewListTag += "<a href='#;'>" + "더보기";
                                reviewListTag += "</a>";
                                reviewListTag += "</div>";

                                reviewListTag += "</li>";
                                index++;
                            }
                        }
                        reviewListTag += "</ul>";
                        divBody.html(reviewListTag);

                        addPaginationImg(param.pageNum, page);
                    },
                    error: function (request, status, error) {
                        
                    }
                });
            }

            function getProductReviewOnlyText(param) {
                $.ajax({
                    type: "POST",
                    url: "/product_review/" + productId + "/text",
                    data: JSON.stringify(param),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        let results = data.list;
                        let page = data.page;

                        var divBody = $("#review_table");
                        divBody.empty();
                        var reviewListTag = "";

                        reviewListTag += "<ul>"
                        var index = 0;
                        var count = Object.keys(results).length;
                        if (count === 0) {
                            reviewListTag += "<li class='evaluation_view no_list_data1905' style='text-align:center'>";
                            reviewListTag += "등록된 상품평이 없습니다.";
                            reviewListTag += "<br>"
                            reviewListTag += "이 상품에 대한 첫 번재 리뷰 글을 작성해주세요~";
                            reviewListTag += "</li>";
                        } else {
                            for (var review of results) {
                                var changeDate = changeDateFormat(review.editDate);
                                console.log(review);

                                reviewListTag += "<li class=" + "'evaluation_view'" + " id=" + "'evaluation_view"
                                    + index
                                    + "'>";
                                //회원 정보 div
                                reviewListTag += "<div class=" + "'member_info_top'" + ">";
                                reviewListTag += "<ul>";
                                reviewListTag += "<li class='name'>" + review.email + "</li>";
                                reviewListTag += "<li class='grade'>" + review.grade + "</li>";
                                reviewListTag += "<li class='date'>" + changeDate + "</li>";
                                reviewListTag += "<li class='stars'>";
                                // 별점은 추후 수정하기
                                reviewListTag += "   <div class='star_score1807'>"
                                reviewListTag += "      <span class='cmt_star'>";
                                reviewListTag += "        <span class='cmt_per star" + review.rate + "'>" + "별점"
                                    + "</span>";
                                reviewListTag += "      </span>";
                                reviewListTag += "</li>";
                                if(review.sentiment_type === "긍정"){
                                    reviewListTag += "<li><span class='w-btn w-btn-gra1 review-btn'>  긍정 </span></li>"
                                }
                                else if(review.sentiment_type === "보통") reviewListTag += "<li><span class='w-btn w-btn-gra1-2 review-btn'>  보통  </span></li>"
                                else reviewListTag += "<li><span class='w-btn w-btn-gra2 review-btn'>  부정  </span></li>"

                                reviewListTag += "</ul>";
                                reviewListTag += "</div>";

                                reviewListTag += "<div class=" + "'member_info_bottom'" + ">";
                                reviewListTag += "<ul>";
                                reviewListTag += "<li class=" + "'choice'>" + " • ";
                                reviewListTag += "<span>" + review.age + "</span>" + " / " + "<span>"
                                    + review.height + "CM" + "</span>" + " / " + "<span>" + review.bodyType
                                    + "</span>"
                                    + " / " + "<span>평소사이즈 : " + review.avgSize + "</span>";
                                reviewListTag += "</li>";
                                reviewListTag += "<li class=" + "'must'>" + " • 구매 정보 : ";
                                reviewListTag += "<span>" + review.productColorId + "</span>" + " / " + "<span>"
                                    + review.productSize + "</span>" + " / " + "<span>더한섬닷컴</span>";
                                reviewListTag += "</li>";
                                reviewListTag += "</ul>";
                                reviewListTag += "</div>";

                                reviewListTag += "<div class=" + "'review_txt_wrap'" + ">";
                                reviewListTag += "  <p class=" + "'review_txt'" + " style='word-wrap:break-word'>"
                                    + review.content + "</p>";
                                reviewListTag += "</div>";

                                reviewListTag += "<div class='review_more_1807'>";
                                reviewListTag += "<a href='#;'>" + "더보기";
                                reviewListTag += "</a>";
                                reviewListTag += "</div>";

                                reviewListTag += "</li>";
                                index++;
                            }
                        }
                        reviewListTag += "</ul>";
                        divBody.html(reviewListTag);

                        addPaginationText(param.pageNum, page);
                    },
                    error: function (request, status, error) {
                        
                    }
                });
            }

            function getProductReview(param) {
                $.ajax({
                    type: "POST",
                    url: "/product_review/" + productId,
                    data: JSON.stringify(param),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        let results = data.list;
                        let page = data.page;

                        var divBody = $("#review_table");
                        divBody.empty();
                        var reviewListTag = "";

                        reviewListTag += "<ul>"
                        var index = 0;
                        var count = Object.keys(results).length;
                        if (count === 0) {
                            reviewListTag += "<li class='evaluation_view no_list_data1905' style='text-align:center'>";
                            reviewListTag += "등록된 상품평이 없습니다.";
                            reviewListTag += "<br>"
                            reviewListTag += "이 상품에 대한 첫 번재 리뷰 글을 작성해주세요~";
                            reviewListTag += "</li>";
                        } else {
                            for (var review of results) {
                                var changeDate = changeDateFormat(review.editDate);
                                console.log(review);

                                reviewListTag += "<li class=" + "'evaluation_view'" + " id=" + "'evaluation_view"
                                    + index
                                    + "'>";
                                //회원 정보 div
                                reviewListTag += "<div class=" + "'member_info_top'" + ">";
                                reviewListTag += "<ul>";
                                reviewListTag += "<li class='name'>" + review.email + "</li>";
                                reviewListTag += "<li class='grade'>" + review.grade + "</li>";
                                reviewListTag += "<li class='date'>" + changeDate + "</li>";
                                reviewListTag += "<li class='stars'>";
                                // 별점은 추후 수정하기
                                reviewListTag += "   <div class='star_score1807'>"
                                reviewListTag += "      <span class='cmt_star'>";
                                reviewListTag += "        <span class='cmt_per star" + review.rate + "'>" + "별점"
                                    + "</span>";
                                reviewListTag += "      </span>";
                                reviewListTag += "</li>";
                                if(review.sentiment_type === "긍정"){
                                    reviewListTag += "<li><span class='w-btn w-btn-gra1 review-btn'>  긍정 </span></li>"
                                }
                                else if(review.sentiment_type === "보통") reviewListTag += "<li><span class='w-btn w-btn-gra1-2 review-btn'>  보통  </span></li>"
                                else reviewListTag += "<li><span class='w-btn w-btn-gra2 review-btn'>  부정  </span></li>"
                                reviewListTag += "</ul>";
                                reviewListTag += "</div>";

                                reviewListTag += "<div class=" + "'member_info_bottom'" + ">";
                                reviewListTag += "<ul>";
                                reviewListTag += "<li class=" + "'choice'>" + " • ";
                                reviewListTag += "<span>" + review.age + "</span>" + " / " + "<span>"
                                    + review.height + "CM" + "</span>" + " / " + "<span>" + review.bodyType
                                    + "</span>"
                                    + " / " + "<span>평소사이즈 : " + review.avgSize + "</span>";
                                reviewListTag += "</li>";
                                reviewListTag += "<li class=" + "'must'>" + " • 구매 정보 : ";
                                reviewListTag += "<span>" + review.productColorId + "</span>" + " / " + "<span>"
                                    + review.productSize + "</span>" + " / " + "<span>더한섬닷컴</span>";
                                reviewListTag += "</li>";
                                reviewListTag += "</ul>";
                                reviewListTag += "</div>";

                                if (review.imgURI != null || review.imgURI === '') {
                                    reviewListTag += "<div class='review_represent_img1912'>";
                                    reviewListTag += "<img src='" + review.imgURI + "' alt='리뷰 이미지'>";
                                    reviewListTag += "</div>";
                                }

                                reviewListTag += "<div class=" + "'review_txt_wrap'" + ">";
                                reviewListTag += "  <p class=" + "'review_txt'" + " style='word-wrap:break-word'>"
                                    + review.content + "</p>";
                                reviewListTag += "</div>";

                                reviewListTag += "<div class='review_more_1807'>";
                                reviewListTag += "<a href='#;'>" + "더보기";
                                reviewListTag += "</a>";
                                reviewListTag += "</div>";

                                reviewListTag += "</li>";
                                index++;
                            }
                        }
                        reviewListTag += "</ul>";
                        divBody.html(reviewListTag);

                        addPagination(param.pageNum, page);
                    },
                    error: function (request, status, error) {
                        
                    }
                });
            }

            function paging(page){
                let pageNum = parseInt(page);
                let param = {
                    "pageNum": pageNum, "amount": amount
                };

                //누르면 해당 리뷰페이지 다시 불러오기!!
                getProductReview(param);
            }

            function pagingImg(page){
                let pageNum = parseInt(page);
                let param = {
                    "pageNum": pageNum, "amount": amount
                };

                //누르면 해당 리뷰페이지 다시 불러오기!!
                getProductReviewOnlyImg(param);
            }

            function pagingText(page){
                let pageNum = parseInt(page);
                let param = {
                    "pageNum": pageNum, "amount": amount
                };

                //누르면 해당 리뷰페이지 다시 불러오기!!
                getProductReviewOnlyText(param);
            }

            function addPagination(pageNum, page) {
                var pagingTag = $('#reviewPagingDiv');
                pagingTag.empty();
                let row = "";
                row += "<a class='prev2' onclick='paging(1)'>처음 페이지로 이동</a>";
                if(page.prev) {
                    row += "<a onclick='paging("+ (page.startPage - 1) +")' class='prev'>이전 페이지로 이동</a>";
                }
                row +=  "<span class='num' id='pagingSpan'>";
                for(var i = page.startPage; i <= page.endPage; i++) {
                    if(i == pageNum) {
                        row += "<a onclick='paging("+ i +")' class='pageBtn  on  ' pagenum='"+i+"'>"+i+"</a>";
                    }
                    else{
                        row += "<a onclick='paging("+ i +")' class='pageBtn  ' pagenum='"+i+"'>"+i+"</a>";
                    }
                }
                row +=  "</span>";
                if (page.next) {
                    row += "<a onclick='paging("+ (page.endPage + 1) +")' class='next'>다음 페이지로 이동</a>";
                }
                row += "<a class='next2' onclick='paging("+ page.realEnd +")'>마지막 페이지로 이동</a>";
                pagingTag.append(row);
            }

            function addPaginationImg(pageNum, page) {
                var pagingTag = $('#reviewPagingDiv');
                pagingTag.empty();
                let row = "";
                row += "<a class='prev2' onclick='pagingImg(1)'>처음 페이지로 이동</a>";
                if(page.prev) {
                    row += "<a onclick='pagingImg("+ (page.startPage - 1) +")' class='prev'>이전 페이지로 이동</a>";
                }
                row +=  "<span class='num' id='pagingSpan'>";
                for(var i = page.startPage; i <= page.endPage; i++) {
                    if(i == pageNum) {
                        row += "<a onclick='pagingImg("+ i +")' class='pageBtn  on  ' pagenum='"+i+"'>"+i+"</a>";
                    }
                    else{
                        row += "<a onclick='pagingImg("+ i +")' class='pageBtn  ' pagenum='"+i+"'>"+i+"</a>";
                    }
                }
                row +=  "</span>";
                if (page.next) {
                    row += "<a onclick='pagingImg("+ (page.endPage + 1) +")' class='next'>다음 페이지로 이동</a>";
                }
                row += "<a class='next2' onclick='pagingImg("+ page.realEnd +")'>마지막 페이지로 이동</a>";
                pagingTag.append(row);
            }

            function addPaginationText(pageNum, page) {
                var pagingTag = $('#reviewPagingDiv');
                pagingTag.empty();
                let row = "";
                row += "<a class='prev2' onclick='pagingText(1)'>처음 페이지로 이동</a>";
                if(page.prev) {
                    row += "<a onclick='pagingText("+ (page.startPage - 1) +")' class='prev'>이전 페이지로 이동</a>";
                }
                row +=  "<span class='num' id='pagingSpan'>";
                for(var i = page.startPage; i <= page.endPage; i++) {
                    if(i == pageNum) {
                        row += "<a onclick='pagingText("+ i +")' class='pageBtn  on  ' pagenum='"+i+"'>"+i+"</a>";
                    }
                    else{
                        row += "<a onclick='pagingText("+ i +")' class='pageBtn  ' pagenum='"+i+"'>"+i+"</a>";
                    }
                }
                row +=  "</span>";
                if (page.next) {
                    row += "<a onclick='pagingText("+ (page.endPage + 1) +")' class='next'>다음 페이지로 이동</a>";
                }
                row += "<a class='next2' onclick='pagingText("+ page.realEnd +")'>마지막 페이지로 이동</a>";
                pagingTag.append(row);
            }
        </script>
    </div>
</th:block>
</html>